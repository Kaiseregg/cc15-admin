
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CombatCart 15 â€“ Admin</title>
<style>
body{font-family:Arial;background:#0b1c1c;color:#fff;padding:20px}
.card{background:#122;border-radius:12px;padding:20px;margin-bottom:30px;overflow:auto}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #333;text-align:left}
button{padding:6px 10px;border-radius:6px;border:none;background:#2a5;color:#fff}
</style>
</head>
<body>

<h2>Orders (cc15_orders)</h2>
<div class="card">
<button onclick="loadOrders()">Reload</button>
<div id="orders"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
function esc(s){return s?String(s).replace(/[&<>"]/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[m])):''}

const url = localStorage.getItem("sb_url");
const key = localStorage.getItem("sb_key");

if(!url||!key){
  const u = prompt("Supabase URL:");
  const k = prompt("Supabase ANON KEY:");
  localStorage.setItem("sb_url",u);
  localStorage.setItem("sb_key",k);
  location.reload();
}

const sb = supabase.createClient(localStorage.getItem("sb_url"),localStorage.getItem("sb_key"));

async function loadOrders(){
  const {data:orders,error} = await sb.from("cc15_orders").select("*").order("created_at",{ascending:false});
  if(error){alert(error.message);return}
  const ids = orders.map(o=>o.id);
  const {data:items} = await sb.from("cc15_order_items").select("*").in("order_id",ids);
  const map={};
  (items||[]).forEach(i=>{
    map[i.order_id]=(map[i.order_id]||[]).concat(`${i.product_name} x${i.qty}`)
  });

  let html="<table><tr><th>Date</th><th>Location</th><th>Total</th><th>Items</th></tr>";
  orders.forEach(o=>{
    html+=`<tr>
      <td>${esc(o.created_at)}</td>
      <td>${esc(o.location)}</td>
      <td>${o.total_chf} CHF</td>
      <td>${(map[o.id]||[]).join("<br>")||"-"}</td>
    </tr>`
  });
  html+="</table>";
  document.getElementById("orders").innerHTML=html;
}

loadOrders();
</script>
</body>
</html>
